---
import { getCollection } from "astro:content";
import H1 from "../../components/h1.astro";
import InfoLayout from "../../layouts/InfoLayout.astro";
import BlogCard from "../../components/BlogCard.astro";
import CategoryTabs from "../../components/CategoryTabs.astro";  // ✅ add this

const allBlogs = await getCollection("articles");

const categories = [...new Set(allBlogs.map((b) => b.data.category))];

const url = new URL(Astro.request.url);
const activeCategory = url.searchParams.get("category");

const filteredBlogs = activeCategory
  ? allBlogs.filter((b) => b.data.category === activeCategory)
  : allBlogs;
---


<InfoLayout>
  <div class="p-6 sm:px-12 pb-20">
    <H1>Blog</H1>

    {categories.length > 0 && (
      <CategoryTabs
        categories={categories}
        activeCategory={activeCategory}
        basePath="/blog"
      />
    )}

    <div class="mt-10 grid gap-8">
      {filteredBlogs.length > 0 ? (
        filteredBlogs.map((blog) => <BlogCard blog={blog} />)
      ) : (
        <p class="text-zinc-400">⚠️ No blogs found.</p>
      )}
    </div>
  </div>
</InfoLayout>


<CategoryTabs
  categories={categories}
  activeCategory={activeCategory}
  basePath="/blog"
/>

